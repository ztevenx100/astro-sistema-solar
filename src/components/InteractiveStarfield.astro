---
export interface Props {
  currentPlanet?: string;
}

const { currentPlanet = '' } = Astro.props;

// Definición de las constelaciones distribuidas alrededor del sistema solar
const constellations = [
  {
    id: 'ursa-major',
    name: 'Osa Mayor',
    distinctiveName: 'El Gran Carro',
    planet: 'Jupiter',
    stars: [
      { name: 'Dubhe', x: 2, y: 8, brightness: 0.9 },
      { name: 'Merak', x: 8, y: 12, brightness: 0.8 },
      { name: 'Phecda', x: 15, y: 10, brightness: 0.7 },
      { name: 'Megrez', x: 22, y: 8, brightness: 0.6 },
      { name: 'Alioth', x: 28, y: 5, brightness: 0.8 },
      { name: 'Mizar', x: 35, y: 3, brightness: 0.7 },
      { name: 'Alkaid', x: 42, y: 2, brightness: 0.9 }
    ],
    lines: [[0,1], [1,2], [2,3], [3,4], [4,5], [5,6]]
  },
  {
    id: 'orion',
    name: 'Orión',
    distinctiveName: 'El Cazador Guerrero',
    planet: 'Mars',
    stars: [
      { name: 'Bellatrix', x: 88, y: 5, brightness: 0.8 },
      { name: 'Betelgeuse', x: 92, y: 10, brightness: 1.0 },
      { name: 'Rigel', x: 95, y: 25, brightness: 0.9 },
      { name: 'Alnitak', x: 90, y: 15, brightness: 0.7 },
      { name: 'Alnilam', x: 93, y: 17, brightness: 0.8 },
      { name: 'Mintaka', x: 96, y: 19, brightness: 0.7 },
      { name: 'Saiph', x: 88, y: 22, brightness: 0.6 }
    ],
    lines: [[0,1], [1,3], [3,4], [4,5], [1,6], [2,6], [3,6]]
  },
  {
    id: 'cassiopeia',
    name: 'Casiopea',
    distinctiveName: 'La Reina Celestial',
    planet: 'Saturn',
    stars: [
      { name: 'Schedar', x: 85, y: 88, brightness: 0.8 },
      { name: 'Caph', x: 90, y: 92, brightness: 0.7 },
      { name: 'Gamma Cas', x: 95, y: 90, brightness: 0.9 },
      { name: 'Ruchbah', x: 98, y: 95, brightness: 0.6 },
      { name: 'Segin', x: 92, y: 98, brightness: 0.5 }
    ],
    lines: [[0,1], [1,2], [2,3], [3,4]]
  },
  {
    id: 'leo',
    name: 'Leo',
    distinctiveName: 'El León Dorado',
    planet: 'Mercury',
    stars: [
      { name: 'Regulus', x: 98, y: 45, brightness: 0.9 },
      { name: 'Algieba', x: 95, y: 50, brightness: 0.7 },
      { name: 'Denebola', x: 92, y: 55, brightness: 0.8 },
      { name: 'Zosma', x: 96, y: 60, brightness: 0.6 },
      { name: 'Chertan', x: 98, y: 65, brightness: 0.5 }
    ],
    lines: [[0,1], [1,2], [2,3], [3,4], [4,0]]
  },
  {
    id: 'aquarius',
    name: 'Acuario',
    distinctiveName: 'El Portador Cósmico',
    planet: 'Uranus',
    stars: [
      { name: 'Sadalsuud', x: 58, y: 95, brightness: 0.8 },
      { name: 'Sadalmelik', x: 52, y: 98, brightness: 0.7 },
      { name: 'Sadachbia', x: 45, y: 96, brightness: 0.6 },
      { name: 'Albali', x: 38, y: 92, brightness: 0.5 }
    ],
    lines: [[0,1], [1,2], [2,3]]
  },
  {
    id: 'gemini',
    name: 'Géminis',
    distinctiveName: 'Los Hermanos Estelares',
    planet: 'Venus',
    stars: [
      { name: 'Castor', x: 15, y: 95, brightness: 0.9 },
      { name: 'Pollux', x: 8, y: 92, brightness: 0.8 },
      { name: 'Alhena', x: 2, y: 88, brightness: 0.7 }
    ],
    lines: [[0,1], [1,2]]
  },
  {
    id: 'scorpius',
    name: 'Escorpión',
    distinctiveName: 'El Guardián Ardiente',
    planet: 'Neptune',
    stars: [
      { name: 'Antares', x: 2, y: 55, brightness: 1.0 },
      { name: 'Shaula', x: 5, y: 48, brightness: 0.8 },
      { name: 'Sargas', x: 8, y: 42, brightness: 0.7 }
    ],
    lines: [[0,1], [0,2]]
  },
  {
    id: 'cygnus',
    name: 'Cisne',
    distinctiveName: 'El Navegante del Norte',
    planet: 'Earth',
    stars: [
      { name: 'Deneb', x: 58, y: 2, brightness: 0.9 },
      { name: 'Sadr', x: 65, y: 5, brightness: 0.8 },
      { name: 'Albireo', x: 72, y: 8, brightness: 0.7 }
    ],
    lines: [[0,1], [1,2]]
  }
];
---

<div class="interactive-starfield">
  <!-- Fondo estrellado aleatorio con más densidad -->
  <div class="starfield-background">
    {Array.from({ length: 400 }, (_, i) => {
      const x = Math.random() * 100;
      const y = Math.random() * 100;
      // Crear más estrellas en los bordes donde están las constelaciones
      const isEdge = x < 15 || x > 85 || y < 15 || y > 85;
      const opacity = isEdge ? 0.4 + Math.random() * 0.5 : 0.2 + Math.random() * 0.3;
      return (
        <div 
          class="background-star"
          style={`
            left: ${x}%;
            top: ${y}%;
            animation-delay: ${Math.random() * 4}s;
            opacity: ${opacity};
          `}
        ></div>
      );
    })}
  </div>

  <!-- Nebulosas de fondo -->
  <div class="nebula nebula-1"></div>
  <div class="nebula nebula-2"></div>
  <div class="nebula nebula-3"></div>

  <!-- Constelaciones -->
  <div class="constellations-container">
    {constellations.map((constellation) => (
      <div 
        class={`constellation ${constellation.planet === currentPlanet ? 'active' : ''}`}
        data-constellation={constellation.id}
        data-planet={constellation.planet}
        onclick={`showConstellationInfo('${constellation.id}')`}
      >
        <!-- Líneas de la constelación -->
        <svg class="constellation-lines" viewBox="0 0 100 100" preserveAspectRatio="none">
          {constellation.lines.map((line) => (
            <line
              x1={constellation.stars[line[0]].x}
              y1={constellation.stars[line[0]].y}
              x2={constellation.stars[line[1]].x}
              y2={constellation.stars[line[1]].y}
              class="constellation-line"
            />
          ))}
        </svg>

        <!-- Estrellas de la constelación -->
        {constellation.stars.map((star, index) => (
          <div
            class="constellation-star"
            style={`
              left: ${star.x}%;
              top: ${star.y}%;
              opacity: ${star.brightness};
            `}
            data-star-name={star.name}
            title={`${star.name} - Ir a ${constellation.distinctiveName} (${constellation.name}) → ${constellation.planet}`}
          >
            <div class="star-glow"></div>
          </div>
        ))}

        <!-- Etiqueta de la constelación -->
        <div 
          class="constellation-label"
          style={`
            left: ${constellation.stars.reduce((sum, star) => sum + star.x, 0) / constellation.stars.length}%;
            top: ${constellation.stars.reduce((sum, star) => sum + star.y, 0) / constellation.stars.length - 3}%;
          `}
        >
          <span class="constellation-distinctive-name">{constellation.distinctiveName}</span>
          <span class="constellation-traditional-name">({constellation.name})</span>
          <span class="constellation-planet">→ {constellation.planet}</span>
        </div>
      </div>
    ))}
  </div>

  <!-- Estrellas fugaces -->
  <div class="shooting-stars">
    {Array.from({ length: 5 }, (_, i) => (
      <div 
        class="shooting-star"
        style={`
          animation-delay: ${i * 8 + Math.random() * 5}s;
          animation-duration: ${2 + Math.random() * 2}s;
        `}
      ></div>
    ))}
  </div>
</div>

<style>
  .interactive-starfield {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
    z-index: 10;
    /* Gradiente sutil para enfatizar los bordes */
    background: radial-gradient(
      ellipse at center,
      transparent 25%, 
      rgba(135, 206, 235, 0.02) 60%, 
      rgba(135, 206, 235, 0.05) 85%,
      rgba(135, 206, 235, 0.08) 100%
    );
  }

  /* Fondo estrellado */
  .starfield-background {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
  }

  .background-star {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    animation: gentle-twinkle 4s infinite;
  }

  /* Constelaciones */
  .constellations-container {
    position: relative;
    width: 100%;
    height: 100%;
  }

  .constellation {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0.9;
    transition: all 0.5s ease;
    pointer-events: auto;
    cursor: pointer;
    z-index: 15;
  }

  .constellation:hover {
    opacity: 1;
    transform: scale(1.02);
    filter: drop-shadow(0 0 15px rgba(135, 206, 235, 0.5));
  }

  .constellation.active {
    opacity: 1;
    filter: drop-shadow(0 0 15px #ffd700);
  }

  .constellation-lines {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 20;
  }

  .constellation-line {
    stroke: #87CEEB;
    stroke-width: 0.15;
    opacity: 0.5;
    transition: opacity 0.3s ease;
    filter: drop-shadow(0 0 2px #87CEEB);
  }

  .constellation:hover .constellation-line,
  .constellation.active .constellation-line {
    opacity: 0.8;
    animation: line-pulse 2s ease-in-out infinite;
  }

  /* Estrellas de constelación - tamaño más pequeño */
  .constellation-star {
    position: absolute;
    width: 7px;
    height: 7px;
    background: radial-gradient(circle, #fff, #87CEEB);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: all 0.3s ease;
    z-index: 25;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.7), 0 0 15px rgba(135, 206, 235, 0.3);
  }

  .constellation:hover .constellation-star {
    animation: star-glow 1.5s ease-in-out infinite;
    box-shadow: 0 0 15px #ffd700, 0 0 25px rgba(255, 215, 0, 0.3);
    transform: translate(-50%, -50%) scale(1.15);
  }

  .star-glow {
    position: absolute;
    width: 100%;
    height: 100%;
    background: inherit;
    border-radius: 50%;
    animation: gentle-twinkle 3s infinite;
  }

  /* Etiquetas de constelación */
  .constellation-label {
    position: absolute;
    transform: translate(-50%, -100%);
    text-align: center;
    pointer-events: none;
    z-index: 30;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .constellation:hover .constellation-label {
    opacity: 1;
    animation: label-glow 2s ease-in-out infinite;
  }

  .constellation-distinctive-name {
    display: block;
    color: #87CEEB;
    font-size: 0.8rem;
    font-weight: bold;
    text-shadow: 0 0 8px rgba(135, 206, 235, 1), 0 0 16px rgba(135, 206, 235, 0.6);
    margin-bottom: 1px;
    letter-spacing: 0.5px;
  }

  .constellation-traditional-name {
    display: block;
    color: #B0C4DE;
    font-size: 0.6rem;
    font-style: italic;
    text-shadow: 0 0 4px rgba(176, 196, 222, 0.8);
    margin-bottom: 3px;
    opacity: 0.9;
  }

  .constellation-planet {
    display: block;
    color: #ffd700;
    font-size: 0.6rem;
    margin-top: 2px;
    text-shadow: 0 0 5px rgba(255, 215, 0, 1), 0 0 10px rgba(255, 215, 0, 0.4);
  }

  /* Estrellas fugaces */
  .shooting-stars {
    position: absolute;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 5;
  }

  .shooting-star {
    position: absolute;
    width: 3px;
    height: 3px;
    background: linear-gradient(45deg, #fff, #87CEEB);
    border-radius: 50%;
    top: 20%;
    left: -10px;
    animation: shooting 4s linear infinite;
    box-shadow: 0 0 8px #87CEEB;
  }

  .shooting-star::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 80px;
    height: 2px;
    background: linear-gradient(90deg, #87CEEB, transparent);
    transform: translate(-50%, -50%);
    border-radius: 50%;
  }

  /* Nebulosas */
  .nebula {
    position: absolute;
    border-radius: 50%;
    filter: blur(20px);
    opacity: 0.1;
    animation: nebula-drift 60s linear infinite;
  }

  .nebula-1 {
    width: 200px;
    height: 200px;
    background: radial-gradient(ellipse, #ff6b6b, transparent);
    top: 20%;
    left: 10%;
    animation-duration: 80s;
  }

  .nebula-2 {
    width: 150px;
    height: 150px;
    background: radial-gradient(ellipse, #4ecdc4, transparent);
    top: 60%;
    right: 15%;
    animation-duration: 100s;
    animation-direction: reverse;
  }

  .nebula-3 {
    width: 100px;
    height: 100px;
    background: radial-gradient(ellipse, #ffe66d, transparent);
    bottom: 20%;
    left: 30%;
    animation-duration: 90s;
  }

  /* Animaciones */
  @keyframes gentle-twinkle {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.8; }
  }

  @keyframes star-glow {
    0%, 100% { transform: translate(-50%, -50%) scale(0.8); opacity: 0.7; }
    50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
  }

  @keyframes line-pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }

  @keyframes shooting {
    0% {
      transform: translateX(0) translateY(0);
      opacity: 1;
    }
    70% {
      opacity: 1;
    }
    100% {
      transform: translateX(120vw) translateY(40vh);
      opacity: 0;
    }
  }

  @keyframes nebula-drift {
    0% { transform: translateX(-10px) translateY(-5px); }
    50% { transform: translateX(10px) translateY(5px); }
    100% { transform: translateX(-10px) translateY(-5px); }
  }

  @keyframes ripple-effect {
    0% {
      width: 20px;
      height: 20px;
      opacity: 1;
    }
    100% {
      width: 60px;
      height: 60px;
      opacity: 0;
    }
  }

  @keyframes label-glow {
    0%, 100% { 
      text-shadow: 
        0 0 8px rgba(135, 206, 235, 1), 
        0 0 15px rgba(135, 206, 235, 0.5);
    }
    50% { 
      text-shadow: 
        0 0 12px rgba(135, 206, 235, 1), 
        0 0 25px rgba(135, 206, 235, 0.8),
        0 0 35px rgba(135, 206, 235, 0.3);
    }
  }

  /* Responsive */
  @media (max-width: 768px) {
    .constellation-star {
      width: 5px;
      height: 5px;
    }
    
    .constellation-name {
      font-size: 0.55rem;
    }
    
    .constellation-planet {
      font-size: 0.45rem;
    }
    
    .constellation-line {
      stroke-width: 0.12;
    }
  }
</style>

<script>
  // Script para navegación por constelaciones
  document.addEventListener('DOMContentLoaded', () => {
    // Mapeo de planetas para navegación
    const planetPaths: Record<string, string> = {
      'mercury': 'mercury',
      'venus': 'venus', 
      'earth': 'earth',
      'mars': 'mars',
      'jupiter': 'jupiter',
      'saturn': 'saturn',
      'uranus': 'uranus',
      'neptune': 'neptune'
    };

    // Función global para mostrar información de constelación
    (window as any).showConstellationInfo = (constellationId: string) => {
      // Datos de constelaciones con nombres distintivos
      const constellations = [
        { id: 'ursa-major', name: 'Osa Mayor', distinctiveName: 'El Gran Carro', planet: 'Jupiter' },
        { id: 'orion', name: 'Orión', distinctiveName: 'El Cazador Guerrero', planet: 'Mars' },
        { id: 'cassiopeia', name: 'Casiopea', distinctiveName: 'La Reina Celestial', planet: 'Saturn' },
        { id: 'leo', name: 'Leo', distinctiveName: 'El León Dorado', planet: 'Mercury' },
        { id: 'aquarius', name: 'Acuario', distinctiveName: 'El Portador Cósmico', planet: 'Uranus' },
        { id: 'gemini', name: 'Géminis', distinctiveName: 'Los Hermanos Estelares', planet: 'Venus' },
        { id: 'scorpius', name: 'Escorpión', distinctiveName: 'El Guardián Ardiente', planet: 'Neptune' },
        { id: 'cygnus', name: 'Cisne', distinctiveName: 'El Navegante del Norte', planet: 'Earth' }
      ];

      const constellation = constellations.find(c => c.id === constellationId);
      if (!constellation) return;

      const planet = constellation.planet.toLowerCase();
      
      // Navegar al planeta
      setTimeout(() => {
        if (planet in planetPaths) {
          window.location.href = `/planets/${planetPaths[planet]}`;
        }
      }, 300);
    };

    // Configurar eventos para constelaciones
    const constellationElements = document.querySelectorAll('.constellation');
    constellationElements.forEach((constellationEl) => {
      const htmlElement = constellationEl as HTMLElement;
      
      // Efectos hover para las estrellas
      const stars = htmlElement.querySelectorAll('.constellation-star');
      stars.forEach((star) => {
        const htmlStar = star as HTMLElement;
        
        star.addEventListener('mouseenter', () => {
          // Crear efecto de ondas
          const ripple = document.createElement('div');
          ripple.style.cssText = `
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 1px solid #ffd700;
            transform: translate(-50%, -50%);
            animation: ripple-effect 1s ease-out;
            pointer-events: none;
            top: 50%;
            left: 50%;
          `;
          
          htmlStar.appendChild(ripple);
          
          setTimeout(() => {
            ripple.remove();
          }, 1000);
        });
      });
    });

    // Efecto de paralaje suave
    document.addEventListener('mousemove', (e) => {
      const mouseX = (e.clientX / window.innerWidth) * 2 - 1;
      const mouseY = (e.clientY / window.innerHeight) * 2 - 1;
      
      const starfield = document.querySelector('.interactive-starfield') as HTMLElement;
      if (starfield) {
        starfield.style.transform = `translate(${mouseX * 3}px, ${mouseY * 3}px)`;
      }
    });
  });
</script>
